#!MANAGED-CONFIG $subs_link interval=21600 strict=true
# Surge 的规则配置手册: https://manual.nssurge.com/
[General]

# > 增强版 Wi-Fi 助理
# 在 Wi-Fi 网络不佳时尝试使用数据网络建立连接，请仅当使用不限量的数据流量时开启
wifi-assist = true
# > 混合网络 Hybrid Network（建议关闭，无限流量或者超出套餐流量不限速可选择开启）
all-hybrid = false

# > Internet 测试 URL
internet-test-url = http://www.aliyun.com
# > 代理测速 URL
proxy-test-url = http://1.1.1.1/generate_204
# > 测试超时（秒）
test-timeout = 5

# > 自定义 GeoIP 数据库
geoip-maxmind-url = https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
# > GeoIP 禁用自动更新
disable-geoip-db-auto-update = false

# > IPv6 支持（默认关闭）
ipv6 = true

# > 允许 Wi-Fi 访问 (仅 iOS ）
allow-wifi-access = true
wifi-access-http-port = 6152
wifi-access-socks5-port = 6153
# > 允许 Wi-Fi 访问 (仅 macOS，若允许远程访问将「127.0.0.1」改为「0.0.0.0」)
http-listen = 127.0.0.1:6152
socks5-listen = 127.0.0.1:6153


# > 跳过代理
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, localhost, *.local, www.baidu.com, yunbusiness.ccb.com, www.abchina.com.cn, login-service.mobile-bank.psbc.com, mobile-bank.psbc.com

# > 路由防火墙
# 包含所有网络请求
include-all-networks = false
# 包含本地网络请求
include-local-networks = false

# > 日志等级
loglevel = notify
# > 当遇到 REJECT 策略时返回错误页
show-error-page-for-reject = true
# > Always Real IP Hosts
always-real-ip = *.lan, cable.auth.com, *.msftconnecttest.com, *.msftncsi.com, xbox.*.microsoft.com

# > DNS劫持
hijack-dns = *:53

# > 排除简单主机名
exclude-simple-hostnames = true

# > DNS 服务器
dns-server = 223.5.5.5, 119.29.29.29
# > 加密的DNS服务器
encrypted-dns-server = h3://dns.alidns.com/dns-query, quic://dns.alidns.com/dns-query, https://dns.alidns.com/dns-query

# > 关闭 DOH 的服务端证书验证
doh-skip-cert-verification = true
# > etc/hosts 读取 DNS 记录
read-etc-hosts = true

# > 代理请求本地DNS映射
use-local-host-item-for-proxy = false

# > UDP IP 防泄漏
udp-policy-not-supported-behaviour = REJECT

# > 提高处理 UDP 流量优先级
udp-priority = true

# > 强行关闭对特定主机名的主动协议探测
always-raw-tcp-hosts = www.google.com, 91.108.56.*, 91.108.4.*, 91.108.8.*, 91.108.16.*, 91.108.12.*, 149.154.16*, 149.154.17*, 91.108.20.*, 185.76.151.*, 91.105.192.*, 5.28.19*


[Panel]
SubscribeInfo = $subscribe_info, style=info

# -----------------------------
# Surge 的几种策略配置规范，请参考 https://manual.nssurge.com/policy/proxy.html
# 不同的代理策略有*很多*可选参数，请参考上方连接的 Parameters 一段，根据需求自行添加参数。
#
# Surge 现已支持 UDP 转发功能，请参考: https://trello.com/c/ugOMxD3u/53-udp-%E8%BD%AC%E5%8F%91
# Surge 现已支持 TCP-Fast-Open 技术，请参考: https://trello.com/c/ij65BU6Q/48-tcp-fast-open-troubleshooting-guide
# Surge 现已支持 ss-libev 的全部加密方式和混淆，请参考: https://trello.com/c/BTr0vG1O/47-ss-libev-%E7%9A%84%E6%94%AF%E6%8C%81%E6%83%85%E5%86%B5
# -----------------------------

[Proxy]
$proxies

[Proxy Group]
Proxy = select, Haha, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, DIRECT, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png
Haha = select, $proxy_group, icon-url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/icon/qure/color/Server.png
🇭🇰 HKG = select, update-interval=0, policy-regex-filter=(🇭🇰)|(港)|(Hong)|(HK), no-alert=0, hidden=0, include-all-proxies=0, include-other-group=Haha, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png
🇺🇸 USA = select, update-interval=0, policy-regex-filter=(🇺🇸)|(美国)|(States)|(US), no-alert=0, hidden=0, include-all-proxies=0, include-other-group=Haha, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png
🇯🇵 JPN = select, update-interval=0, policy-regex-filter=(🇯🇵)|(日)|(Japan)|(JP), no-alert=0, hidden=0, include-all-proxies=0, include-other-group=Haha, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png
🇸🇬 SGP = select, update-interval=0, policy-regex-filter=(🇸🇬)|(新加坡)|(Singapore)|(SG), no-alert=0, hidden=0, include-all-proxies=0, include-other-group=Haha, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png
🇨🇳 TWN = select, update-interval=0, policy-regex-filter=(🇨🇳)|(台)|(Tai)|(TW), no-alert=0, hidden=0, include-all-proxies=0, include-other-group=Haha, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png
🇺🇳 Edge = select, update-interval=0, policy-regex-filter=^(?i)(?!.*(?:🇭🇰|香港|HK|Hong|🇯🇵|日本|JP|Japan|🇺🇸|美国|US|USA|America|United States|🇸🇬|新加坡|SG|Singapore|🇹🇼|台湾|TW|Taiwan|🇨🇳)).+$, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_Nations.png, include-other-group=Haha
Open Ai = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/ChatGPT.png, policy-regex-filter=TW|JP|SG|US, include-other-group=Haha
Telegram = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png, include-other-group=Haha
Discord = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Discord.png, include-other-group=Haha
Twitter = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Twitter.png, include-other-group=Haha
YouTube = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png, include-other-group=Haha
Netflix = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Netflix.png, include-other-group=Haha
Disney+ = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Disney.png, include-other-group=Haha
HBO = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/HBO_Max.png, include-other-group=Haha
Bilibili = select, DIRECT, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/bilibili_4.png, include-other-group=Haha
Emby = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, DIRECT, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/black2c7/Emby-icons/main/Icons/Emby111.png, include-other-group=Haha
PikPak = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/black2c7/Emby-icons/main/Icons/Pikpak3.png, include-other-group=Haha
TikTok = select, DIRECT, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/TikTok.png, include-other-group=Haha
GlobalMedia = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png, include-other-group=Haha
ChinaMedia = select, DIRECT, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/China_Map.png, include-other-group=Haha
PayPal = select, DIRECT, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/PayPal.png, include-other-group=Haha
Google = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png, include-other-group=Haha
Apple&Microsoft = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, DIRECT, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Apple.png, include-other-group=Haha
Crypto = select, Proxy, "🇭🇰 HKG", "🇺🇸 USA", "🇸🇬 SGP", "🇯🇵 JPN", "🇨🇳 TWN", 🇺🇳 Edge, DIRECT, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/bian.png, include-other-group=Haha
Steam = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, DIRECT, DIRECT, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Steam.png, include-other-group=Haha
Final = select, Proxy, 🇭🇰 HKG, 🇺🇸 USA, 🇸🇬 SGP, 🇯🇵 JPN, 🇨🇳 TWN, 🇺🇳 Edge, DIRECT, no-alert=0, hidden=0, include-all-proxies=0, icon-url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/icon/qure/color/Final.png, include-other-group=Haha


[Rule]
# 杂项
PROCESS-NAME,/Applications/OrbStack.app/,DIRECT
# 强制订阅域名直连
DOMAIN,$subs_domain,DIRECT
# > Emby
RULE-SET,https://raw.githubusercontent.com/haha-miao/rule_file/refs/heads/main/surge/emby/emby-direct.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/haha-miao/rule_file/refs/heads/main/surge/emby/emby-proxy,Emby
# > 屏蔽 YouTube 的 UDP
AND,((PROTOCOL,UDP), (DOMAIN-SUFFIX,googlevideo.com)),REJECT-NO-DROP
# > 腾讯 WeChat
RULE-SET,https://github.com/NobyDa/Script/raw/master/Surge/WeChat.list,DIRECT
# > 防止应用循环请求
IP-CIDR,0.0.0.0/32,REJECT,no-resolve
# > 规则修正
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Direct/Direct.list,DIRECT
# > 虚拟货币
RULE-SET,https://raw.githubusercontent.com/haha-miao/rule_file/refs/heads/main/surge/crypto/Crypto.list,Crypto
# > PayPal
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/PayPal/PayPal.list,PayPal
# > TG
IP-CIDR,95.161.76.100/31,REJECT-DROP,no-resolve
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Telegram/Telegram.list,Telegram
# > Open AI
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/OpenAI/OpenAI.list,"Open Ai",extended-matching
# > Discord
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Discord/Discord.list,Discord
# > 苹果微软
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Microsoft/Microsoft.list,Apple&Microsoft
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Apple/Apple_All_No_Resolve.list,Apple&Microsoft
# > Steam
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Surge/SteamCN/SteamCN.list,Steam
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Steam/Steam.list,Steam
# > PikPak
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/PikPak/PikPak.list,PikPak
# > YouTube
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTube/YouTube.list,YouTube
# > Twitter
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Twitter/Twitter.list,Twitter
# > Netflix
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Netflix/Netflix.list,Netflix
# > Disney+
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Disney/Disney.list,Disney+
# > HBO
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/HBO/HBO.list,HBO
# > 中国媒体
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaMedia/ChinaMedia.list,ChinaMedia
# > 全球媒体
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GlobalMedia/GlobalMedia_All_No_Resolve.list,GlobalMedia
# 谷歌服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Google/Google.list,Google
# Proxy
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Surge/Proxy/Proxy_All_No_Resolve.list,Proxy,extended-matching
# Direct
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Surge/ChinaMax/ChinaMax_All_No_Resolve.list,DIRECT,extended-matching
# 局域网地址
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Surge/Lan/Lan.list,DIRECT
# DNS 查询失败 Final 规则
FINAL,Final,dns-failed

[URL Rewrite]
^https?:\/\/(www\.)?g\.cn https://www.google.com 302
^https?:\/\/(www\.)?google\.cn https://www.google.com 302



[Host]
# 微信
# *.tencent.com = 119.29.29.29
# *.qq.com = 119.29.29.29
*.weixin.com = 119.29.29.29
# Firebase Cloud Messaging
mtalk.google.com = 108.177.125.188
# Apple TestFlight
*testflight.apple.com = server:8.8.4.4

[URL Rewrite]
^https?:\/\/(www\.)?g\.cn https://www.google.com 302
^https?:\/\/(www\.)?google\.cn https://www.google.com 302
